<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Retro Hoops</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #d68b30;
    touch-action: none;
}

#gameContainer {
    position: relative;
    width: 100vw;
    height: 90vh;
    margin: 0 auto;
    background: #d68b30;
}

canvas {
    width: 100%;
    height: 100%;
    display: block;
}

/* Buttons */
#controls {
    position: absolute;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
}

.btn {
    width: 90px;
    height: 45px;
    background: black;
    color: white;
    border-radius: 6px;
    text-align: center;
    line-height: 45px;
    font-weight: bold;
    font-size: 16px;
}

/* Joystick */
#joystickBase {
    position: absolute;
    bottom: 20px;
    left: 20px;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: rgba(0,0,0,0.3);
}

#joystickStick {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255,255,255,0.8);
    left: 30px;
    top: 30px;
}
</style>
</head>
<body>

<div id="gameContainer">
    <canvas id="game"></canvas>

    <div id="joystickBase">
        <div id="joystickStick"></div>
    </div>

    <div id="controls">
        <div id="shootBtn" class="btn">SHOOT</div>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = canvas.parentElement.clientWidth;
canvas.height = canvas.parentElement.clientHeight;

const joystickBase = document.getElementById("joystickBase");
const joystickStick = document.getElementById("joystickStick");
const shootBtn = document.getElementById("shootBtn");

/* ======================
   GAME VARIABLES
====================== */

let player = {x: 120, y: canvas.height/2, radius: 15};
let ball = {x: player.x, y: player.y};
let score = 0;

let joystickEnabled = true;

/* ======================
   SHOT METER VARIABLES
====================== */

let shooting = false;
let linePos = 0;
let lineSpeed = 3;
let lineMoving = true;

const meter = {
    width: 200,
    height: 18,
    greenStart: 80,
    greenEnd: 120
};

/* ======================
   SHOT ANIMATION
====================== */

let shootingBall = false;
let shotProgress = 0;

const hoop = {
    x: canvas.width - 50,
    y: canvas.height/2,
    radius: 18
};

/* ======================
   JOYSTICK LOGIC
====================== */

let dragging = false;
const baseRadius = 60;
const stickRadius = 30;

function resetStick(){
    joystickStick.style.left = "30px";
    joystickStick.style.top = "30px";
}

joystickBase.addEventListener("touchstart", e=>{
    if(!joystickEnabled) return;
    dragging = true;
});

joystickBase.addEventListener("touchmove", e=>{
    if(!dragging || !joystickEnabled) return;

    const rect = joystickBase.getBoundingClientRect();
    const touch = e.touches[0];

    let dx = touch.clientX - (rect.left + baseRadius);
    let dy = touch.clientY - (rect.top + baseRadius);

    const distance = Math.sqrt(dx*dx + dy*dy);

    if(distance > baseRadius){
        dx = dx / distance * baseRadius;
        dy = dy / distance * baseRadius;
    }

    joystickStick.style.left = (dx + baseRadius - stickRadius) + "px";
    joystickStick.style.top = (dy + baseRadius - stickRadius) + "px";

    player.x += dx * 0.05;
    player.y += dy * 0.05;
});

joystickBase.addEventListener("touchend", e=>{
    dragging = false;
    resetStick();
});

/* ======================
   SHOOT BUTTON
====================== */

shootBtn.ontouchstart = function(){

    if(!shooting){
        // START shooting
        shooting = true;
        joystickEnabled = false; // DISABLE joystick
        lineMoving = true;
        linePos = 0;
    }
    else{
        // STOP timing
        lineMoving = false;

        let chance = 0;

        if(linePos >= meter.greenStart && linePos <= meter.greenEnd){
            chance = 90;
        } else {
            let dist = Math.min(
                Math.abs(linePos - meter.greenStart),
                Math.abs(linePos - meter.greenEnd)
            );
            chance = Math.max(10, 90 - dist*2);
        }

        if(Math.random()*100 < chance){
            score += 2;
        }

        shooting = false;
        shootingBall = true;
        shotProgress = 0;
    }
};

/* ======================
   DRAW FUNCTIONS
====================== */

function drawCourt(){
    ctx.fillStyle="#d68b30";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    ctx.strokeStyle="white";
    ctx.lineWidth=3;
    ctx.beginPath();
    ctx.moveTo(canvas.width/2,0);
    ctx.lineTo(canvas.width/2,canvas.height);
    ctx.stroke();

    ctx.beginPath();
    ctx.strokeStyle="orange";
    ctx.arc(hoop.x, hoop.y, hoop.radius, 0, Math.PI*2);
    ctx.stroke();
}

function drawShotMeter(){
    if(!shooting) return;

    const meterXPos = canvas.width/2 - meter.width/2;
    const meterYPos = 40; // TOP of screen

    ctx.fillStyle="red";
    ctx.fillRect(meterXPos, meterYPos, meter.width, meter.height);

    ctx.fillStyle="green";
    ctx.fillRect(
        meterXPos + meter.greenStart,
        meterYPos,
        meter.greenEnd - meter.greenStart,
        meter.height
    );

    ctx.fillStyle="white";
    ctx.fillRect(meterXPos + linePos, meterYPos, 3, meter.height);

    if(lineMoving){
        linePos += lineSpeed;
        if(linePos > meter.width || linePos < 0){
            lineSpeed *= -1;
        }
    }
}

/* ======================
   GAME LOOP
====================== */

function update(){

    drawCourt();

    if(shootingBall){
        shotProgress += 0.05;

        ball.x = player.x + (hoop.x - player.x) * shotProgress;
        ball.y = player.y + (hoop.y - player.y) * shotProgress
                 - 60 * Math.sin(Math.PI * shotProgress);

        if(shotProgress >= 1){
            shootingBall = false;
            joystickEnabled = true; // RE-ENABLE joystick
            player.x = 120;
            player.y = canvas.height/2;
        }
    } else {
        ball.x = player.x;
        ball.y = player.y;
    }

    ctx.beginPath();
    ctx.fillStyle="white";
    ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
    ctx.fill();

    ctx.beginPath();
    ctx.fillStyle="orange";
    ctx.arc(ball.x, ball.y, 6, 0, Math.PI*2);
    ctx.fill();

    ctx.fillStyle="white";
    ctx.font="20px Arial";
    ctx.fillText("Score: " + score, 20, 30);

    drawShotMeter();

    requestAnimationFrame(update);
}

resetStick();
update();
</script>

</body>
</html>
