<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Retro Hoops 5v5</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:#d8a45b;
  touch-action:none;
}

canvas{
  display:block;
}

.button{
  position:absolute;
  width:70px;
  height:70px;
  border-radius:50%;
  border:none;
  font-weight:bold;
  color:white;
}

#passBtn{ right:20px; bottom:100px; background:#1e90ff; }
#shootBtn{ right:20px; bottom:180px; background:#ff3b30; }

#stealBtn{ right:20px; bottom:100px; background:#9b59b6; display:none; }
#blockBtn{ right:20px; bottom:180px; background:#f39c12; display:none; }
</style>
</head>
<body>

<canvas id="game"></canvas>

<button id="passBtn" class="button">PASS</button>
<button id="shootBtn" class="button">SHOOT</button>
<button id="stealBtn" class="button">STEAL</button>
<button id="blockBtn" class="button">BLOCK</button>

<script>
  <script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize",resizeCanvas);

let possession="offense";
let currentPlayer=0;
let score=0;
let speed=3;

let players=[];
let defenders=[];

for(let i=0;i<5;i++){
  players.push({x:150,y:120+i*80,color:"blue",shoot:70+Math.random()*20});
  defenders.push({x:canvas.width-200,y:120+i*80,color:"red"});
}

let keys={x:0,y:0};

canvas.addEventListener("touchmove",e=>{
  let t=e.touches[0];
  let controlled = possession==="offense" ? players[currentPlayer] : defenders[currentPlayer];
  keys.x=(t.clientX-controlled.x)*0.01;
  keys.y=(t.clientY-controlled.y)*0.01;
});

function drawCourt(){
  ctx.fillStyle="#d8a45b";
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawPlayer(p,i,isTeam){
  ctx.fillStyle=p.color;
  ctx.fillRect(p.x,p.y,25,25);

  if(i===currentPlayer){
    ctx.strokeStyle="yellow";
    ctx.strokeRect(p.x,p.y,25,25);
  }
}

function updateDefenseAI(){
  defenders.forEach((def,i)=>{
    if(possession==="offense"){
      let target=players[i];
      let dx=target.x-def.x;
      let dy=target.y-def.y;
      let dist=Math.sqrt(dx*dx+dy*dy);
      if(dist>5){
        def.x+=dx/dist*2;
        def.y+=dy/dist*2;
      }
    }
  });
}

function updateOffenseAI(){
  if(possession==="defense"){
    players.forEach((pl,i)=>{
      if(i!==currentPlayer){
        pl.x+=Math.random()*2-1;
        pl.y+=Math.random()*2-1;
      }
    });
  }
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawCourt();

  let controlled = possession==="offense" ? players[currentPlayer] : defenders[currentPlayer];

  controlled.x+=keys.x*speed;
  controlled.y+=keys.y*speed;

  updateDefenseAI();
  updateOffenseAI();

  players.forEach((p,i)=>drawPlayer(p,i,true));
  defenders.forEach((d,i)=>drawPlayer(d,i,false));

  ctx.fillStyle="black";
  ctx.font="20px Arial";
  ctx.fillText("Score: "+score,20,30);
  ctx.fillText("Mode: "+possession,20,60);

  requestAnimationFrame(update);
}
update();

/* OFFENSE BUTTONS */

passBtn.onclick=()=>{
  if(possession==="offense"){
    currentPlayer=(currentPlayer+1)%5;
  }
};

shootBtn.onclick=()=>{
  if(possession==="offense"){
    let shooter=players[currentPlayer];
    let distance=canvas.width-shooter.x;
    let contest=0;

    defenders.forEach(def=>{
      let dx=def.x-shooter.x;
      let dy=def.y-shooter.y;
      let d=Math.sqrt(dx*dx+dy*dy);
      if(d<80) contest+=25;
    });

    let chance=shooter.shoot-distance*0.05-contest;

    if(Math.random()*100<chance){
      score+=2;
      possession="defense";
      alert("Bucket!");
      switchToDefense();
    } else {
      possession="defense";
      alert("Missed!");
      switchToDefense();
    }
  }
};

/* DEFENSE BUTTONS */

stealBtn.onclick=()=>{
  if(possession==="defense"){
    let def=defenders[currentPlayer];
    let ballHandler=players[currentPlayer];
    let dx=def.x-ballHandler.x;
    let dy=def.y-ballHandler.y;
    let d=Math.sqrt(dx*dx+dy*dy);

    if(d<50 && Math.random()<0.5){
      possession="offense";
      alert("Steal!");
      switchToOffense();
    }
  }
};

blockBtn.onclick=()=>{
  if(possession==="defense"){
    alert("Contest!");
  }
};

function switchToDefense(){
  passBtn.style.display="none";
  shootBtn.style.display="none";
  stealBtn.style.display="block";
  blockBtn.style.display="block";
  currentPlayer=0;
}

function switchToOffense(){
  passBtn.style.display="block";
  shootBtn.style.display="block";
  stealBtn.style.display="none";
  blockBtn.style.display="none";
  currentPlayer=0;
}
</script>
</script>

</body>
</html>
